<div class="qcm-generator-container">
  <div class="generator-header">
    <div class="header-content">
      <a (click)="goBack()" class="back-link">
        <span class="back-icon">‚Üê</span>
        <span>Retour</span>
      </a>
      <div class="header-title-section">
        <h1>
          <span class="header-icon">ü§ñ</span>
          G√©n√©rateur de QCM avec IA
        </h1>
        <p class="subtitle">Uploadez un document ou collez du texte pour g√©n√©rer automatiquement un QCM avec correction</p>
        <p *ngIf="courseTitle" class="course-title">
          <span class="course-icon">üìö</span>
          Cours: {{ courseTitle }}
        </p>
      </div>
    </div>
  </div>

  <div *ngIf="!qcmResponse" class="input-section">
    <div class="section-header">
      <h2>
        <span class="section-icon">üì§</span>
        Charger votre contenu
      </h2>
    </div>

    <div class="form-group">
      <label for="fileInput">
        <span class="label-icon">üìÅ</span>
        S√©lectionnez un document (PDF, TXT, MD, CSV)
      </label>
      <div class="file-upload-wrapper">
        <input
          type="file"
          id="fileInput"
          accept=".pdf,.txt,.md,.csv,application/pdf,text/plain"
          (change)="onFileSelected($event)"
          class="file-input"
        />
        <label for="fileInput" class="file-upload-label">
          <span class="upload-icon">üì§</span>
          <span>Choisir un fichier</span>
        </label>
        <small class="form-hint">Les fichiers PDF et texte sont support√©s. Les fichiers DOCX ne sont pas encore support√©s.</small>
      </div>
    </div>

    <div class="divider">
      <span>OU</span>
    </div>

    <div class="form-group">
      <label for="documentText">
        <span class="label-icon">üìù</span>
        Collez le texte du document
      </label>
      <textarea
        id="documentText"
        [(ngModel)]="documentText"
        class="form-control"
        rows="10"
        placeholder="Collez ici le texte du document √† partir duquel vous voulez g√©n√©rer un QCM..."
      ></textarea>
    </div>

    <div class="form-group">
      <label for="numberOfQuestions">
        <span class="label-icon">üî¢</span>
        Nombre de questions
      </label>
      <input
        type="number"
        id="numberOfQuestions"
        [(ngModel)]="numberOfQuestions"
        min="1"
        max="20"
        class="form-control"
      />
    </div>

    <div *ngIf="errorMessage" class="alert alert-error">
      <span class="alert-icon">‚ùå</span>
      <span>{{ errorMessage }}</span>
    </div>

    <div class="form-actions">
      <button
        class="btn btn-primary"
        (click)="generateQcm()"
        [disabled]="loading || (!documentText && !selectedFile)"
      >
        <span class="btn-icon" *ngIf="!loading">‚ú®</span>
        <span *ngIf="loading" class="loading-spinner">‚è≥</span>
        <span>{{ loading ? 'G√©n√©ration en cours...' : 'G√©n√©rer le QCM' }}</span>
      </button>
    </div>
  </div>

  <div *ngIf="qcmResponse && !showResults" class="qcm-section">
    <div class="qcm-header">
      <div class="header-top">
        <h2>
          <span class="header-icon">üìã</span>
          QCM G√©n√©r√©
        </h2>
        <button class="btn btn-secondary" (click)="resetQcm()">
          <span>üîÑ</span>
          <span>Nouveau QCM</span>
        </button>
      </div>
      <div class="summary-box">
        <p class="summary">{{ qcmResponse.documentSummary }}</p>
      </div>
    </div>

    <form [formGroup]="qcmForm" (ngSubmit)="submitQcm()">
      <div class="questions-list" formArrayName="answers">
        <div class="question-item" *ngFor="let question of qcmResponse.questions; let i = index" [formGroupName]="i">
          <div class="question-header">
            <span class="question-number">Question {{ i + 1 }}</span>
          </div>
          <p class="question-text">{{ question.question }}</p>

          <div class="options-list">
            <label *ngFor="let option of question.options; let j = index" class="option-label">
              <input
                type="radio"
                formControlName="selectedAnswer"
                [value]="option"
                [name]="'question_' + i"
                class="radio-input"
              />
              <span class="radio-custom"></span>
              <span class="option-text">{{ option }}</span>
            </label>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary" [disabled]="qcmForm.invalid">
          Soumettre et voir les r√©sultats
        </button>
      </div>
    </form>
  </div>

  <div *ngIf="showResults && qcmResult" class="results-section">
    <div class="results-header">
      <h2>
        <span class="header-icon">üìä</span>
        R√©sultats du QCM
      </h2>
      <div class="score-display">
        <div class="score-circle">
          <span class="score">{{ qcmResult.score }}/{{ qcmResult.totalQuestions }}</span>
          <span class="percentage">
            {{ ((qcmResult.score / qcmResult.totalQuestions) * 100).toFixed(0) }}%
          </span>
        </div>
      </div>
    </div>

    <div class="results-list">
      <div
        class="result-item"
        *ngFor="let answer of qcmResult.answers; let i = index"
        [class.correct]="answer.selectedAnswer === qcmResult.questions[i].correctAnswer"
        [class.incorrect]="answer.selectedAnswer !== qcmResult.questions[i].correctAnswer"
      >
        <div class="result-header">
          <span class="question-number">Question {{ i + 1 }}</span>
          <span *ngIf="answer.selectedAnswer === qcmResult.questions[i].correctAnswer" class="result-badge correct-badge">
            ‚úì Correct
          </span>
          <span *ngIf="answer.selectedAnswer !== qcmResult.questions[i].correctAnswer" class="result-badge incorrect-badge">
            ‚úó Incorrect
          </span>
        </div>
        <p class="question-text">{{ qcmResult.questions[i].question }}</p>
        <div class="answer-info">
          <div class="answer-row">
            <span class="answer-label">Votre r√©ponse:</span>
            <span [class.correct-answer]="answer.selectedAnswer === qcmResult.questions[i].correctAnswer"
                  [class.wrong-answer]="answer.selectedAnswer !== qcmResult.questions[i].correctAnswer"
                  class="answer-value">
              {{ answer.selectedAnswer || 'Aucune r√©ponse' }}
            </span>
          </div>
          <div class="answer-row">
            <span class="answer-label">R√©ponse correcte:</span>
            <span class="correct-answer answer-value">{{ qcmResult.questions[i].correctAnswer }}</span>
          </div>
          <div class="explanation">
            <span class="explanation-icon">üí°</span>
            <div class="explanation-content">
              <strong>Explication:</strong> {{ qcmResult.questions[i].explanation }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button class="btn btn-primary" (click)="resetQcm()">Cr√©er un nouveau QCM</button>
    </div>
  </div>
</div>

